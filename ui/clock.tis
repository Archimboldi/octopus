include "sciter:reactor.tis";

class Clock: Reactor.Component 
{
  const styleset = ["clock", $url(clock.css)]; // style set declaration
  var time = new Date().valueOf()+ 86400000; // setting initial state
  this var tomorrow = new Date(time).toLocaleString(#date);
  this var res = "   ";
  this var rec = "   ";
  // function this(props,kids,states,parent) {
  //   // stdout.println(props,kids,states,parent);
  //   stdout.println(time);
  // }

  // function attached() { // a.k.a. React::componentDidMount
  //   this.timer(1s, function() {
  //     // this.update { time:new Date() };
  //     return true; // to keep the timer ticking
  //   });
  // }
 
  function render() {
    return
     <clock>
     <form #f1>
      档案类型:
        <select|dropdown name="dalx">
          <option value="1" selected>基建档案</option>
          <option value="17">基建档案（SZ,ZB）</option>
          <option value="7">文书档案</option>
          <option value="8">会计档案</option>
          <option value="10">合同档案</option>
          <option value="6">规划档案</option>
          <option value="22">规划档案（建设管理）</option>
          <option value="3">环评档案</option>
          <option value="20">环评档案（一级）</option>
          <option value="19">环评档案（二级）</option>
          <option value="12">印模档案</option>
          <option value="4">声像档案</option>
          <option value="5">实物档案</option>
          <option value="23">政府采购</option>
        </select>
        <input type="date" name="startd" value="now" /> - 
        <input type="date" name="endd" value={this.tomorrow} />
        <button.index>检索</button>
        <label>{this.res}</label>
        <button.export>详情</button>
     </form>
     <form #f2>
      <input type="date" name="today" value="now" />
      <label>挂接量：</label><input name="sl" />
      <label>页数：</label><input name="ys" />
      <button.record>记录</button>
      <label>{this.rec}</label>
      <button.export2>详情</button>
     </form>
     </clock>;
  }
  event click $(button.index) {
    var val = $(#f1).value;
    var sd = val.startd.toLocaleString(#date);
    var ed = val.endd.toLocaleString(#date);
    var lx = val.dalx;
    this.update{res: view.index_sum(lx,sd,ed)};
  }
  event click $(button.export) {
    view.exporto(0);
  }
  event click $(button.record) {
    var val = $(#f2).value;
    var td = val.today.toLocaleString(#date);
    var sl = val.sl;
    var ys = val.ys;
    var rec = view.write(td,sl,ys);
    if (rec === 0) {
      this.update{
        rec:"保存成功！"
      }
    }else{
      this.update{
        rec: "保存失败！"
      }
    }
  }
  event click $(button.export2) {
    view.exporto(1);
  }
}
